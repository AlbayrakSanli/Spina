// Generated by CoffeeScript 2.5.0
(function() {
  // Scaffold
  var ready;

  $(document).on('click', '.table-clickable tr', function(e) {
    var $firstRow, $row, checkbox, link;
    $row = $(this).closest('tr');
    link = $row.find('a.table-link:first')[0];
    if (link) {
      return link.click();
    } else {
      checkbox = $(this).find('input[type="checkbox"]:first, input[type="radio"]:first');
      if (checkbox.length > 0) {
        if (!checkbox.prop("checked") && e.shiftKey) {
          $firstRow = $('.table-clickable tr input[type="checkbox"]:checked:first').closest('tr');
          if ($firstRow.index() < $row.index()) {
            $firstRow.nextUntil($row).each(function() {
              return $(this).find('input[type="checkbox"]:first').prop("checked", true);
            });
          } else {
            $firstRow.prevUntil($row).each(function() {
              return $(this).find('input[type="checkbox"]:first').prop("checked", true);
            });
          }
          document.getSelection().removeAllRanges();
        }
        checkbox.prop("checked", !checkbox.prop("checked"));
        checkbox.trigger('checked');
        return e.stopPropagation();
      }
    }
  });

  $(document).on('click', '.table-clickable .table-link', function(e) {
    return e.stopPropagation();
  });

  $(document).on('click', '.table-clickable tr input', function(e) {
    return e.stopPropagation();
  });

  // Search inputs
  $(document).on('keyup', '.search-input input', function(e) {
    $(this).parent().removeClass('animated small-shake');
    if ($(this).val() === "") {
      $(this).parent().find('.clear-input').fadeOut(200);
      if (e.keyCode === 13) {
        return $(this).parent().addClass('animated small-shake');
      }
    } else {
      return $(this).parent().find('.clear-input').fadeIn(200);
    }
  });

  $(document).on('click', '.clear-input', function() {
    var input, link;
    link = $(this);
    input = link.siblings('input');
    input.val("");
    input.focus();
    input.trigger("keyup");
    link.fadeOut(200);
    return false;
  });

  $(document).on('keyup + change', '.table-container .search-input input', function() {
    var datatable;
    datatable = $(this).parent().parent().find('table.datatable').dataTable();
    return datatable.fnFilter($(this).val());
  });

  $(document).on('change', '.dd', function() {
    var serialized, sort_url;
    serialized = $(this).nestable('serialize');
    sort_url = $(this).data('sort-url');
    return $.post(sort_url, {
      list: serialized
    });
  });

  ready = function() {
    var header, headerHeight;
    // Set paddingTop for section#main
    if (header = document.getElementById('header')) {
      headerHeight = header.getBoundingClientRect().height;
      $('section#main').css({
        paddingTop: headerHeight
      });
    }
    // Login wrapper
    $('#login_wrapper').css('margin-top', $(document).innerHeight() / 8);
    // Custom file
    $('input[type="file"][data-customfileinput]:visible').each(function() {
      return $(this).customFileInput();
    });
    $(".structure-form-menu ul").sortable({
      handle: '.sortable-handle'
    });
    // Switch
    if ($('input[data-switch]').length > 0) {
      $('input[data-switch]').spinaSwitch();
    }
    // Datepicker
    if ($('.datepicker').length > 0) {
      return $('.datepicker').datepicker({
        dateFormat: "dd-mm-yy",
        firstDay: 1
      });
    }
  };

  $(document).on('turbolinks:load', ready);

}).call(this);
